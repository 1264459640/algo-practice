# A* 寻路算法项目使用指南

## 项目概述

本项目是一个完整的A*寻路算法实现，包含控制台演示程序和Godot可视化界面。项目提供了多种启发式函数、网格生成工具、性能分析功能，适合学习、研究和实际应用。

## 环境要求

### 系统要求
- Windows 10/11 或 Linux 或 macOS
- .NET 8.0 或更高版本
- Godot 4.4 或更高版本（用于可视化演示）

### 开发环境
- Visual Studio 2022 或 Visual Studio Code
- C# 开发工具包
- Godot Engine（可选，用于可视化）

## 快速开始

### 1. 克隆或下载项目
```bash
# 如果使用Git
git clone <repository-url>
cd astar

# 或直接下载并解压项目文件
```

### 2. 构建项目
```bash
# 使用.NET CLI构建
dotnet build

# 或使用Visual Studio打开AStar.sln
```

### 3. 运行控制台演示
```bash
# 运行控制台演示程序
dotnet run --project AStar.csproj
```

### 4. 运行Godot可视化演示
1. 打开Godot Engine
2. 导入项目（选择project.godot文件）
3. 点击运行按钮或按F5

## 控制台演示程序

### 主菜单功能

控制台程序提供以下功能选项：

1. **基础寻路演示** - 在简单网格上演示A*算法
2. **启发式函数比较** - 比较不同启发式函数的性能
3. **多路径寻找** - 寻找多条可能的路径
4. **随机障碍物测试** - 在随机生成的障碍物环境中测试
5. **迷宫寻路** - 在生成的迷宫中进行寻路
6. **性能测试** - 测试算法在不同条件下的性能
7. **自定义地图** - 创建和测试自定义地图
8. **退出程序**

### 使用示例

#### 基础寻路演示
```
选择功能: 1
网格大小: 10x10
起点: (0, 0)
终点: (9, 9)
启发式函数: 曼哈顿距离
是否允许对角移动: 否

结果:
✓ 找到路径!
路径长度: 19步
路径代价: 18.00
执行时间: 2.34ms
访问节点数: 45
搜索效率: 42.22%
```

#### 启发式函数比较
程序会自动比较三种启发式函数：
- 曼哈顿距离
- 欧几里得距离  
- 对角距离

显示每种函数的性能指标，帮助选择最适合的启发式函数。

#### 性能测试
可以测试不同网格大小、障碍物密度下的算法性能：
```
网格大小: 50x50
障碍物密度: 30%
测试次数: 100次

平均执行时间: 15.67ms
成功率: 87%
平均路径长度: 67.3步
```

## Godot可视化演示

### 界面介绍

可视化界面包含以下区域：
- **标题栏**：显示程序名称
- **按钮栏**：各种功能按钮
- **控制面板**：参数设置选项
- **网格区域**：可交互的寻路网格
- **结果显示**：算法执行结果和统计信息
- **图例**：颜色和符号说明

### 操作说明

#### 鼠标操作
- **左键点击**：设置起点（绿色S）
- **右键点击**：设置终点（红色E）
- **中键点击**：切换障碍物（黑色■）

#### 按钮功能
1. **创建网格**：生成新的空白网格
2. **寻找路径**：执行A*算法寻找路径
3. **比较启发式**：比较不同启发式函数的性能
4. **生成障碍物**：随机生成障碍物（30%密度）
5. **生成迷宫**：使用递归回溯算法生成迷宫
6. **重置**：清除所有设置，回到初始状态

#### 参数设置
- **启发式函数**：选择曼哈顿距离、欧几里得距离或对角距离
- **对角移动**：勾选允许8方向移动，否则只允许4方向
- **网格大小**：调整网格尺寸（5-20）

#### 快捷键
- **1**：创建网格
- **2**：寻找路径
- **3**：比较启发式函数
- **4**：生成障碍物
- **5**：生成迷宫
- **R**：重置
- **ESC**：退出程序

### 颜色图例
- 🟢 **绿色S**：起点
- 🔴 **红色E**：终点
- ⬛ **黑色■**：障碍物
- 🟡 **黄色●**：最终路径
- 🔵 **浅蓝色●**：开放列表（待评估节点）
- ⚫ **灰色●**：关闭列表（已评估节点）
- ⬜ **白色**：空地

## API 使用说明

### 核心类介绍

#### Node类
表示网格中的一个节点：
```csharp
var node = new Node(x, y);
node.IsObstacle = true;  // 设置为障碍物
node.G = 10;             // 设置G值
node.H = 15;             // 设置H值
```

#### Grid类
表示寻路网格：
```csharp
var grid = new Grid(width, height);
grid.SetObstacle(x, y, true);           // 设置障碍物
var neighbors = grid.GetNeighbors(node); // 获取邻居节点
grid.GenerateRandomObstacles(0.3);      // 生成30%密度的随机障碍物
```

#### AStarPathfinder类
执行A*算法：
```csharp
var result = AStarPathfinder.FindPath(
    grid,                           // 网格
    startNode,                      // 起点
    endNode,                        // 终点
    HeuristicType.Manhattan,        // 启发式函数
    allowDiagonal: false            // 是否允许对角移动
);

if (result.PathFound)
{
    Console.WriteLine($"路径长度: {result.Path.Count}");
    Console.WriteLine($"执行时间: {result.ExecutionTime}ms");
}
```

### 高级功能

#### 多路径寻找
```csharp
var paths = AStarPathfinder.FindMultiplePaths(
    grid, startNode, endNode, maxPaths: 5
);

foreach (var path in paths)
{
    Console.WriteLine($"路径长度: {path.Count}");
}
```

#### 自定义启发式函数
```csharp
// 实现自定义启发式函数
public static double CustomHeuristic(Node current, Node target)
{
    // 自定义计算逻辑
    return Math.Abs(current.X - target.X) + Math.Abs(current.Y - target.Y);
}
```

#### 路径验证
```csharp
bool isValid = AStarPathfinder.ValidatePath(grid, path);
if (!isValid)
{
    Console.WriteLine("路径包含无效移动或障碍物");
}
```

## 性能优化建议

### 1. 启发式函数选择
- **网格地图 + 4方向移动**：使用曼哈顿距离
- **网格地图 + 8方向移动**：使用对角距离
- **连续空间**：使用欧几里得距离

### 2. 数据结构优化
- 使用优先队列（堆）实现开放列表
- 使用哈希表快速查找节点状态
- 预分配内存避免频繁分配

### 3. 算法参数调整
- 根据应用场景选择合适的网格分辨率
- 考虑使用加权A*在速度和精度间平衡
- 对于动态环境，考虑使用增量式重规划

## 常见问题解答

### Q: 为什么找不到路径？
A: 可能的原因：
- 起点或终点被障碍物包围
- 起点和终点之间被障碍物完全阻隔
- 网格边界设置问题

### Q: 如何提高算法性能？
A: 建议：
- 选择合适的启发式函数
- 减少不必要的节点扩展
- 使用更高效的数据结构
- 考虑预处理和缓存

### Q: 对角移动时路径看起来不自然？
A: 这是正常现象，可以通过以下方式改善：
- 使用路径平滑算法
- 调整对角移动的代价
- 使用更精细的网格分辨率

### Q: 如何处理动态障碍物？
A: 建议：
- 使用D*或D* Lite算法
- 实现增量式重规划
- 缓存部分计算结果

## 扩展开发

### 添加新的启发式函数
1. 在`HeuristicType`枚举中添加新类型
2. 在`AStarPathfinder.CalculateHeuristic`方法中添加计算逻辑
3. 更新UI选项（如果需要）

### 集成到其他项目
1. 复制核心类文件（Node.cs, Grid.cs, AStar.cs, AStarResult.cs）
2. 根据需要调整命名空间
3. 实现项目特定的网格表示和约束

### 性能监控
项目提供了详细的性能统计：
- 执行时间
- 访问节点数
- 搜索效率
- 内存使用情况

可以基于这些指标进行进一步的优化和调整。

## 技术支持

如果在使用过程中遇到问题，可以：
1. 查看项目文档和代码注释
2. 运行控制台演示程序进行测试
3. 使用Godot可视化界面调试算法行为
4. 参考项目中的单元测试用例

## 许可证

本项目采用MIT许可证，可以自由使用、修改和分发。详细信息请参见LICENSE文件。